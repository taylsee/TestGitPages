<!DOCTYPE html>
<html>
<head>
    <title>Concert Tickets - TESTNET</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #ff6b6b 0%, #feca57 100%);
            color: white;
            min-height: 100vh;
        }
        .ticket {
            background: white;
            color: black;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            margin: 20px 0;
        }
        .testnet-badge {
            background: #ff4757;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-bottom: 10px;
            display: inline-block;
        }
        .buy-button {
            background: #0088cc;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px 0;
        }
        .address-box {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            word-break: break-all;
            font-size: 12px;
            border: 2px dashed #0088cc;
        }
        .status {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background: #4CAF50; }
        .processing { background: #FF9800; }
        .error { background: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <div class="testnet-badge">üö® TESTNET MODE - –¢–ï–°–¢–û–í–´–ï –ü–õ–ê–¢–ï–ñ–ò</div>
        <h1>üéµ –ö–æ–Ω—Ü–µ—Ä—Ç–Ω—ã–µ –ë–∏–ª–µ—Ç—ã</h1>
        
        <div class="ticket">
            <h2>üî• –†–æ–∫-–≥—Ä—É–ø–ø–∞ "–ú–µ–º—ã"</h2>
            <p>üìÖ –î–∞—Ç–∞: 25 –¥–µ–∫–∞–±—Ä—è 2024</p>
            <p>üìç –ú–µ—Å—Ç–æ: –ú–æ—Å–∫–≤–∞, –ö—Ä–æ–∫—É—Å –°–∏—Ç–∏ –•–æ–ª–ª</p>
            <p>üíé –¶–µ–Ω–∞: <strong>0.1 TEST TON</strong></p>
            
            <div class="qr-code">
                <img id="qrImage" src="" alt="QR Code" style="max-width: 200px;">
            </div>
            
            <p>–ê–¥—Ä–µ—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã (TESTNET):</p>
            <div class="address-box" id="paymentAddress">
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
            
            <button class="buy-button" id="payButton" onclick="checkPayment()">
                üîÑ –ü–†–û–í–ï–†–ò–¢–¨ –û–ü–õ–ê–¢–£
            </button>
            
            <p style="font-size: 12px; color: #666; margin-top: 10px;">
                ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ TESTNET –∫–æ—à–µ–ª–µ–∫!<br>
                –ü–æ–ª—É—á–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ TON: @testgiver_ton_bot
            </p>
        </div>

        <div id="status"></div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        
        // üîÑ –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® –¢–ï–°–¢–û–í–´–ô –ê–î–†–ï–°!
        const PAYMENT_ADDRESS = "0QCxjxXxLJfZ4gmH-dTiOG2oN9rV_1UAzO0316vV292gtdq6"; // –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞
        const PAYMENT_AMOUNT = 0.1; // TEST TON
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å –¥–ª—è –æ–ø–ª–∞—Ç—ã
        document.getElementById('paymentAddress').textContent = PAYMENT_ADDRESS;
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥ –¥–ª—è Tonkeeper
        const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=ton://transfer/${PAYMENT_ADDRESS}?amount=${PAYMENT_AMOUNT * 1000000000}&network=testnet`;
        document.getElementById('qrImage').src = qrUrl;

        async function checkPayment() {
            const statusDiv = document.getElementById('status');
            const payButton = document.getElementById('payButton');
            
            statusDiv.innerHTML = '<div class="status processing">üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–ª–æ–∫—á–µ–π–Ω TESTNET...</div>';
            payButton.disabled = true;
            payButton.textContent = 'üîç –ü–†–û–í–ï–†–Ø–ï–ú TESTNET...';
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º TON API –¥–ª—è TESTNET
                const response = await fetch(`https://testnet.tonapi.io/v2/accounts/${PAYMENT_ADDRESS}/events?limit=20`);
                const data = await response.json();
                
                let paymentFound = false;
                let transactionHash = '';
                
                if (data.events) {
                    for (let event of data.events) {
                        for (let action of event.actions) {
                            if (action.type === 'TonTransfer' && 
                                action.TonTransfer.recipient.address === PAYMENT_ADDRESS &&
                                action.TonTransfer.amount >= 100000000) { // 0.1 TON –≤ –Ω–∞–Ω–æ–¢–û–ù
                                
                                paymentFound = true;
                                transactionHash = event.event_id;
                                break;
                            }
                        }
                        if (paymentFound) break;
                    }
                }
                
                if (paymentFound) {
                    // –£–°–ü–ï–®–ù–ê–Ø –û–ü–õ–ê–¢–ê –í TESTNET!
                    statusDiv.innerHTML = `
                        <div class="status success">
                            ‚úÖ –¢–ï–°–¢–û–í–ê–Ø –û–ü–õ–ê–¢–ê –ü–†–û–®–õ–ê –£–°–ü–ï–®–ù–û!
                        </div>
                        <div class="status success">
                            üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–π –±–∏–ª–µ—Ç –≤ –±–ª–æ–∫—á–µ–π–Ω–µ!
                        </div>
                    `;
                    
                    // –°–æ–æ–±—â–∞–µ–º –±–æ—Ç—É –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
                    setTimeout(() => {
                        tg.sendData(JSON.stringify({
                            action: 'testnet_payment_received',
                            ticket_id: 'test_ticket_' + Date.now(),
                            amount: PAYMENT_AMOUNT,
                            address: PAYMENT_ADDRESS,
                            tx_hash: transactionHash,
                            network: 'testnet'
                        }));
                    }, 1000);
                    
                } else {
                    statusDiv.innerHTML = `
                        <div class="status error">
                            ‚ùå –ü–ª–∞—Ç–µ–∂ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ TESTNET
                        </div>
                        <div class="status">
                            üí° –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:<br>
                            ‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ TESTNET –∫–æ—à–µ–ª–µ–∫<br>
                            ‚Ä¢ –û—Ç–ø—Ä–∞–≤–∏–ª–∏ 0.1 TEST TON<br>
                            ‚Ä¢ –ü–æ–¥–æ–∂–¥–∞–ª–∏ 10-30 —Å–µ–∫—É–Ω–¥
                        </div>
                    `;
                    payButton.disabled = false;
                    payButton.textContent = 'üîÑ –ü–†–û–í–ï–†–ò–¢–¨ –û–ü–õ–ê–¢–£';
                }
                
            } catch (error) {
                console.error('Error:', error);
                statusDiv.innerHTML = '<div class="status error">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ TESTNET</div>';
                payButton.disabled = false;
                payButton.textContent = 'üîÑ –ü–†–û–í–ï–†–ò–¢–¨ –û–ü–õ–ê–¢–£';
            }
        }

        // –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
        setInterval(checkPayment, 15000);
        
        tg.ready();
    </script>
</body>
</html>